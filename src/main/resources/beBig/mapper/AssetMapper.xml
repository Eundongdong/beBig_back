<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="beBig.mapper.AssetMapper">
    <!-- userId로 계좌 정보를 조회하는 쿼리  -->
    <select id="findAccountNumByUserId" resultType="string">
        SELECT account_num
        FROM account JOIN user ON account.user_id = user.user_id
        WHERE user.user_id =#{userId}
    </select>

    <!-- accountNum으로 Transaction 출금 정보를 조회하는 쿼리 -->
    <!-- 출금만 가져옴-->
    <select id="findTransactionsByAccountNum" resultType="TransactionVo">
        SELECT *
        FROM transaction JOIN account ON transaction.account_num = account.account_num
        WHERE transaction.account_num = #{accountNum}
        AND transaction.transaction_type='출금'
    </select>

    <!-- List<accountNum>에 있는 잔액의 총 합을 가져오는 쿼리-->
    <select id="findTotalAssetsByAccountNum" resultType="long" parameterType="list">
        SELECT sum(transaction_balance) as balance
        FROM transaction
        WHERE account_num IN
        <foreach item="accountNum" collection="list" open="(" separator="," close=")">
            #{accountNum}
        </foreach>
        AND transaction_date = (
        SELECT MAX(transaction_date)
        FROM transaction t2
        WHERE t2.account_num = transaction.account_num
        )
    </select>


</mapper>